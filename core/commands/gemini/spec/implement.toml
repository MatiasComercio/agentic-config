description = "Execute /spec IMPLEMENT stage - Usage: /spec:implement [SPEC_PATH]"

prompt = """
## STAGE INSTRUCTIONS (from agents/spec/IMPLEMENT.md):

@{agents/spec/IMPLEMENT.md}

---

## TARGET SPEC FILE

Provided arguments: {{args}}

## INSTRUCTIONS

### 1. Determine SPEC_PATH

- **If {{args}} is provided (not empty):**
  - SPEC_PATH = {{args}} (remove `@` prefix if present)

- **If {{args}} is empty:**
  - Search backwards through conversation history
  - Look for most recent `/spec` or `/spec:*` command with a file path
  - Extract that file path as SPEC_PATH
  - **If no previous /spec found:** Respond with error:
    ```
    ERROR: No spec file in context.
    Usage: /spec:implement <SPEC_PATH>
    Example: /spec:implement specs/2025/11/21/001-repo-init/001.md
    ```

### 2. Read Target Spec File

Read the spec file at SPEC_PATH

### 3. Execute IMPLEMENT Workflow

Follow the EXACT workflow steps defined in the STAGE INSTRUCTIONS above (from IMPLEMENT.md) against the target spec file.

### 4. Important Notes

- RIGHT AFTER starting: RE-READ the spec file at SPEC_PATH
- REFLECT exact steps you will take based on your understanding
- WAIT for explicit user confirmation ("OK" or equivalent)
- EXECUTE the IMPLEMENT stage workflow as defined above
- COMMIT code changes and spec file with implementation status

Refer to AGENTS.md for complete /spec workflow documentation.

## EXAMPLES

**With explicit path:**
```
User: /spec:implement specs/2025/11/21/001-repo-init/001.md
→ SPEC_PATH = specs/2025/11/21/001-repo-init/001.md
```

**Context-derived path:**
```
User: /spec:research specs/2025/11/21/001-repo-init/001.md
... (RESEARCH executes)
User: /spec:plan
... (PLAN executes)
User: /spec:implement
→ SPEC_PATH = specs/2025/11/21/001-repo-init/001.md (derived from previous)
```
"""
